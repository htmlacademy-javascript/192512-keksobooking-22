(()=>{var e={735:()=>{const e=["gif","jpg","jpeg","png"],t=document.querySelector(".ad-form-header__preview img"),r=document.querySelector(".ad-form__field input[type=file]"),o=document.querySelector(".ad-form__upload input[type=file]"),n=document.querySelector(".ad-form__photo");r.addEventListener("change",(()=>{const o=r.files[0],n=o.name.toLowerCase();if(e.some((e=>n.endsWith(e)))){const e=new FileReader;e.addEventListener("load",(()=>{t.src=e.result})),e.readAsDataURL(o)}})),o.addEventListener("change",(()=>{const t=o.files[0],r=t.name.toLowerCase();if(e.some((e=>r.endsWith(e)))){const e=new FileReader;e.addEventListener("load",(()=>{const t=document.createElement("img");t.width=70,t.height=70,t.src=e.result,n.appendChild(t)})),e.readAsDataURL(t)}}))}},t={};function r(o){var n=t[o];if(void 0!==n)return n.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,r),a.exports}(()=>{"use strict";const e=document.querySelector(".ad-form"),t=document.querySelector(".map__filters"),o=e.children,n=Array.from(o),a=t.children,c=Array.from(a),i=35.6895,s=139.69171,l=L.map("map-canvas"),u=L.icon({iconUrl:"img/pin.svg",iconSize:[40,40],iconAnchor:[20,40]});let d=L.layerGroup().addTo(l);const p=function(e){e.forEach((e=>{L.marker({lat:e.location.lat,lng:e.location.lng},{icon:u}).addTo(d).bindPopup((e=>{const t=document.querySelector("#card").content.querySelector(".popup").cloneNode(!0),r=t.querySelector(".popup__title"),o=t.querySelector(".popup__text--address"),n=t.querySelector(".popup__text--price"),a=t.querySelector(".popup__type"),c=t.querySelector(".popup__text--capacity"),i=t.querySelector(".popup__text--time"),s=t.querySelector(".popup__features"),l=t.querySelector(".popup__description"),u=t.querySelector(".popup__photos"),d=t.querySelector(".popup__avatar");return r.textContent=e.offer.title,o.textContent=e.offer.address,n.textContent=`${e.offer.price} ₽/ночь`,a.textContent=e.offer.type,c.textContent=`${e.offer.rooms} комнаты для ${e.offer.guests} гостей`,i.textContent=`Заезд после ${e.offer.checkin}, выезд до ${e.offer.checkout}`,s.innerHTML=e.offer.features.map((e=>`<li class="popup__feature popup__feature--${e}"></li>`)).join(""),l.textContent=e.offer.description,u.innerHTML=e.offer.photos.map((e=>`<img src="${e}" class="popup__photo" width="45" height="40" alt="Фотография жилья"></img>`)).join(""),d.src=e.author.avatar,t})(e))}))},f=function(e,t){e.classList.add("ad-form--disabled"),t.forEach((e=>{e.setAttribute("disabled","true")}))};f(e,n),f(t,c);const m=function(e,t){e.classList.remove("ad-form--disabled"),t.forEach((e=>{e.removeAttribute("disabled")}))};l.on("load",(()=>{m(e,n),m(t,c)})).setView({lat:i,lng:s},10),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(l);const y=L.icon({iconUrl:"img/main-pin.svg",iconSize:[52,52],iconAnchor:[26,52]}),h=(e,t)=>{document.querySelector("#address").value=`${e.toFixed(5)}, ${t.toFixed(5)}`},g=L.marker({lat:i,lng:s},{draggable:!0,icon:y});g.addTo(l),h(i,s),g.on("moveend",(e=>{const t=e.target.getLatLng();h(t.lat,t.lng)}));const v=(e,t)=>{const r=document.querySelector(e).content.querySelector(t).cloneNode(!0);document.querySelector("main").appendChild(r);const o=e=>{"Escape"===e.code&&(r.remove(),document.removeEventListener("keydown",o))};document.addEventListener("keydown",o)},S=document.querySelector(".ad-form"),q=S.querySelector("#type"),b=S.querySelector("#price"),x=S.querySelector("#timein"),E=S.querySelector("#timeout"),w=S.querySelector("#room_number"),k=S.querySelectorAll("#capacity option"),A={bungalow:0,flat:1e3,palace:1e4,house:5e3},C={1:["1"],2:["1","2"],3:["1","2","3"],100:["0"]};S.addEventListener("submit",(e=>{var t,r;e.preventDefault(),t=new FormData(e.target),r=()=>{v("#error",".error")},fetch("https://22.javascript.pages.academy/keksobooking",{method:"POST",credentials:"same-origin",body:t}).then((e=>{e.ok?(S.reset(),v("#success",".success"),l.setView({lat:i,lng:s},10),g.setLatLng({lat:i,lng:s}),h(i,s)):r()})).catch((()=>{r()}))})),q.addEventListener("change",(()=>{b.min=A[q.value],b.placeholder=A[q.value]})),x.addEventListener("change",(()=>{E.value=x.value})),E.addEventListener("change",(()=>{x.value=E.value}));const T=()=>{k.forEach((e=>{e.removeAttribute("selected"),e.disabled=!0,C[w.value].includes(e.value)&&(e.setAttribute("selected",!0),e.disabled=!1)}))};T(),w.addEventListener("change",T);const $=document.querySelector(".map__filters"),j=$.querySelector("#housing-type"),F=$.querySelector("#housing-price"),N=$.querySelector("#housing-rooms"),D=$.querySelector("#housing-guests");let R=[];var U;(U=e=>{R=e,p(R.slice(0,10)),$.addEventListener("change",_.debounce((()=>{const e=(e=>e.filter((e=>((e,t)=>"any"===t||e.offer.type===t)(e,j.value)&&((e,t)=>"any"===t||e.offer.price<=1e4&&"low"===t||e.offer.price>1e4&&e.offer.price<=5e4&&"middle"===t||e.offer.price>5e4&&"high"===t)(e,F.value)&&((e,t)=>"any"===t||Number(t)===Number(e.offer.rooms))(e,N.value)&&((e,t)=>"any"===t||Number(t)===e.offer.guests)(e,D.value)&&(e=>{const t=$.querySelectorAll(".map__checkbox:checked");return Array.from(t).map((e=>e.value)).every((t=>e.offer.features.includes(t)))})(e))))(R);l.removeLayer(d),d=L.layerGroup().addTo(l),p(e.slice(0,10))}),500))},()=>fetch("https://22.javascript.pages.academy/keksobooking/data",{method:"GET",credentials:"same-origin"}).then((e=>{if(e.ok)return e.json()})).then((e=>{U(e)})))(),r(735)})()})();
//# sourceMappingURL=main.bundle.js.map